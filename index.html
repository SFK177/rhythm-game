<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ­£æ‹³ä¸­æ®µçªãåˆ¤æ–­ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>

<style>
body{
 text-align:center;
 font-family:sans-serif;
 background:#f5f5f5;
}

#target{
 width:220px;
 height:220px;
 margin:30px auto;
 border-radius:50%;
 background:gray;
}

button{
 font-size:18px;
 padding:10px 20px;
 margin:6px;
}

.flash{
 animation:flashRed 0.25s;
}

@keyframes flashRed{
 0%{background:#ff0000;}
 100%{background:#f5f5f5;}
}
</style>
</head>

<body>

<h2>æ­£æ‹³ä¸­æ®µçªã åˆ¤æ–­ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h2>

<div id="target"></div>

<div>ã‚¹ã‚³ã‚¢ï¼š<span id="score">0</span></div>
<div>ã‚³ãƒ³ãƒœï¼š<span id="combo">0</span></div>
<div>æ®‹ã‚Šï¼š<span id="time">30</span>ç§’</div>

<button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button id="sendBtn" disabled>ãƒ©ãƒ³ã‚­ãƒ³ã‚°é€ä¿¡</button>
<button onclick="location.reload()">å†æŒ‘æˆ¦</button>

<!-- éŸ³ -->
<audio id="bgm" loop>
<source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">
</audio>

<audio id="hit">
<source src="https://www.soundjay.com/button/sounds/button-16.mp3">
</audio>

<audio id="end">
<source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3">
</audio>

<audio id="rankHigh">
<source src="https://www.soundjay.com/misc/sounds/fanfare-1.mp3">
</audio>

<script>
let score=0
let combo=0
let time=30
let playing=false
let type=""
let timer

const target=document.getElementById("target")
const scoreEl=document.getElementById("score")
const comboEl=document.getElementById("combo")
const timeEl=document.getElementById("time")
const sendBtn=document.getElementById("sendBtn")

// ãƒ©ãƒ³ã‚¯
function getRank(s){
 if(s<50) return "è¦‹ç¿’ã„"
 if(s<150) return "åˆç´š"
 if(s<300) return "ä¸­ç´š"
 if(s<500) return "ä¸Šç´š"
 if(s<800) return "é»’å¸¯å€™è£œ"
 return "å¸«ç¯„ç´šğŸ”¥"
}

// è‰²ç”Ÿæˆ
function nextTarget(){
 const r=Math.random()
 if(r<0.4){type="blue";target.style.background="blue"}
 else if(r<0.75){type="green";target.style.background="green"}
 else{type="red";target.style.background="red"}
}

// æŠ¼ã—ãŸæ™‚
target.onclick=()=>{
 if(!playing)return

 document.getElementById("hit").play()

 if(type==="blue"){
   score+=10
   combo++
 }
 else if(type==="green"){
   combo++
   score+=combo*2
 }
 else{
   score=0
   combo=0

   if(navigator.vibrate) navigator.vibrate(200)
   document.body.classList.add("flash")
   setTimeout(()=>document.body.classList.remove("flash"),200)
 }

 update()
 nextTarget()
}

// æ›´æ–°
function update(){
 scoreEl.textContent=score
 comboEl.textContent=combo
}

// ã‚¹ã‚¿ãƒ¼ãƒˆ
startBtn.onclick=()=>{
 score=0
 combo=0
 time=30
 playing=true
 sendBtn.disabled=true

 document.getElementById("bgm").volume=0.2
 document.getElementById("bgm").play()

 update()
 nextTarget()
 timeEl.textContent=time

 timer=setInterval(()=>{
   time--
   timeEl.textContent=time

   if(time<=0){
     clearInterval(timer)
     playing=false

     document.getElementById("bgm").pause()
     document.getElementById("end").play()
     document.getElementById("rankHigh").play()

     alert("çµ‚äº†ï¼\nã‚¹ã‚³ã‚¢ï¼š"+score+"\nãƒ©ãƒ³ã‚¯ï¼š"+getRank(score))

     sendBtn.disabled=false
   }
 },1000)
}

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°é€ä¿¡ï¼ˆGASï¼‰
sendBtn.onclick=()=>{
 const name=prompt("åå‰ã‚’å…¥åŠ›")
 if(!name)return

 fetch("https://script.google.com/macros/s/AKfycbw3iOC_7EBRqfXUZjnblOXdTI8gcLcpA8RqEf_lurK9YQhcO5AduBAMJBLo71qfbHET/exec",{
   method:"POST",
   body:JSON.stringify({name:name,score:score})
 })
 alert("é€ä¿¡ã—ã¾ã—ãŸï¼")
}
</script>

</body>
</html>
