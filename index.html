<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çªãåˆ¤æ–­ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>

<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#f5f5f5;
}

#btn{
  width:220px;
  height:220px;
  border-radius:50%;
  margin:40px auto;
  line-height:220px;
  font-size:26px;
  color:white;
  user-select:none;
}

#startBtn,#retryBtn{
  padding:12px 24px;
  font-size:18px;
  margin-top:10px;
}

#score,#combo,#time{
  font-size:22px;
  margin:6px;
}
</style>
</head>

<body>

<h2>çªãåˆ¤æ–­ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h2>

<div id="time">æ®‹ã‚Š30ç§’</div>
<div id="score">ã‚¹ã‚³ã‚¢:0</div>
<div id="combo">ã‚³ãƒ³ãƒœ:0</div>

<div id="btn" style="background:gray">å¾…æ©Ÿ</div>

<button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button id="retryBtn" style="display:none">ã‚‚ã†ä¸€å›</button>

<!-- åŠ¹æœéŸ³ -->
<audio id="hit" src="https://www.soundjay.com/mechanical/sounds/swish-1.mp3"></audio>
<audio id="end" src="https://www.soundjay.com/button/beep-10.mp3"></audio>

<!-- ğŸ¥‹ æŠ¼å¿ãƒœã‚¤ã‚¹ -->
<audio id="osvoice" src="https://www.soundjay.com/human/sounds/applause-8.mp3"></audio>

<!-- ğŸµ BGM -->
<audio id="bgm" loop>
 <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">
</audio>

<script>
let score=0
let combo=0
let time=30
let playing=false
let timer
let colorTimer

const btn=document.getElementById("btn")
const scoreText=document.getElementById("score")
const comboText=document.getElementById("combo")
const timeText=document.getElementById("time")

const hit=document.getElementById("hit")
const end=document.getElementById("end")
const osvoice=document.getElementById("osvoice")
const bgm=document.getElementById("bgm")

// è‰²å‡ºç¾
function spawn(){
 const r=Math.random()

 if(r<0.5){
   btn.style.background="blue"
   btn.dataset.type="blue"
   btn.textContent="çªã‘ï¼"
 }
 else if(r<0.8){
   btn.style.background="green"
   btn.dataset.type="green"
   btn.textContent="é€Ÿçªãï¼"

   // ğŸ¥‹ ç·‘ã ã‘æŠ¼å¿ï¼
   osvoice.currentTime=0
   osvoice.play()
 }
 else{
   btn.style.background="red"
   btn.dataset.type="red"
   btn.textContent="æ­¢ã¾ã‚Œï¼"
 }
}

// æŠ¼ã—ãŸåˆ¤å®š
btn.onclick=()=>{
 if(!playing)return

 hit.currentTime=0
 hit.play()

 const type=btn.dataset.type

 if(type==="blue"){
   combo++
   score+=10*combo
 }
 else if(type==="green"){
   combo++
   score+=30*combo
 }
 else if(type==="red"){
   score=0
   combo=0
 }

 scoreText.textContent="ã‚¹ã‚³ã‚¢:"+score
 comboText.textContent="ã‚³ãƒ³ãƒœ:"+combo
}

// ã‚¹ã‚¿ãƒ¼ãƒˆ
document.getElementById("startBtn").onclick=()=>{
 score=0
 combo=0
 time=30
 playing=true

 bgm.volume=0.3
 bgm.currentTime=0
 bgm.play()

 scoreText.textContent="ã‚¹ã‚³ã‚¢:0"
 comboText.textContent="ã‚³ãƒ³ãƒœ:0"
 timeText.textContent="æ®‹ã‚Š30ç§’"

 spawn()
 colorTimer=setInterval(spawn,900)

 timer=setInterval(()=>{
  time--
  timeText.textContent="æ®‹ã‚Š"+time+"ç§’"
  if(time<=0)endGame()
 },1000)
}

// çµ‚äº†
function endGame(){
 playing=false
 clearInterval(timer)
 clearInterval(colorTimer)

 btn.style.background="gray"
 btn.textContent="çµ‚äº†"

 end.play()
 bgm.pause()

 document.getElementById("retryBtn").style.display="inline"

 const name=prompt("åå‰ã‚’å…¥åŠ›")
 if(name){
 fetch("https://script.google.com/macros/s/AKfycbw3iOC_7EBRqfXUZjnblOXdTI8gcLcpA8RqEf_lurK9YQhcO5AduBAMJBLo71qfbHET/exec",{
   method:"POST",
   body:JSON.stringify({name:name,score:score})
 })
 }
}

// å†æŒ‘æˆ¦
document.getElementById("retryBtn").onclick=()=>{
 document.getElementById("retryBtn").style.display="none"
 document.getElementById("startBtn").click()
}
</script>

</body>
</html>
