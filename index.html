<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>赤はおさないで</title>

<style>

body{
  margin:0;
  font-family:sans-serif;
  text-align:center;
  color:white;
  height:100vh;
  overflow:hidden;

  background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#1a2a6c);
  background-size:400% 400%;
  animation:bgMove 12s ease infinite;
}

/* 背景アニメーション */
@keyframes bgMove{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* 浮遊粒子 */
body::after{
  content:"";
  position:fixed;
  top:0;
  left:0;
  width:200%;
  height:200%;
  background-image:radial-gradient(white 1px, transparent 1px);
  background-size:40px 40px;
  opacity:0.15;
  animation:stars 40s linear infinite;
}

@keyframes stars{
  from{transform:translate(0,0);}
  to{transform:translate(-200px,-200px);}
}


/* タイトル */
h1{
  margin-top:15px;
  font-size:36px;
  line-height:1.2;
}

#sub{
  font-size:26px;
  margin-bottom:10px;
}

/* 情報 */
#info{
  font-size:22px;
}

/* メッセージ */
#msg{
  height:40px;
  font-size:28px;
  font-weight:bold;
}

/* ボタン */
button{
  font-size:20px;
  padding:10px 20px;
  margin:10px;
}

/* 押す丸 */
#circle{
  width:170px;
  height:170px;
  border-radius:50%;
  margin:20px auto;
  box-shadow:0 0 25px rgba(255,255,255,0.6);
  transition:0.15s;
}

.flash{
  animation:flash 0.25s;
}

@keyframes flash{
  from{background:white;}
  to{background:inherit;}
}

</style>
</head>

<body>

<h1>館長の神ゲー</h1>
<div id="sub">赤はおさないで</div>

<div id="info">
スコア: <span id="score">0</span>
コンボ: <span id="combo">0</span>
残り: <span id="time">30</span>
</div>

<div id="msg"></div>

<div id="circle"></div>

<button onclick="start()">スタート</button>
<button onclick="retry()">再挑戦</button>

<audio id="bgm" loop>
<source src="https://actions.google.com/sounds/v1/ambiences/bird_forest.ogg">
</audio>

<script>

let score=0;
let combo=0;
let time=30;
let running=false;
let color="blue";
let timer;
let changer;

const circle=document.getElementById("circle");
const msg=document.getElementById("msg");
const bgm=document.getElementById("bgm");

function randColor(){
  const r=Math.random();
  if(r<0.4) color="blue";
  else if(r<0.8) color="green";
  else color="red";
  circle.style.background=color;
}

circle.onclick=()=>{
  if(!running) return;

  if(color==="blue"){
    score++;
    combo++;
    msg.innerText="いいよ";
  }

  if(color==="green"){
    score+=3;
    combo++;
    msg.innerText="さいこー";
  }

  if(color==="red"){
    score=0;
    combo=0;
    msg.innerText="いやーん";

    circle.classList.add("flash");
    setTimeout(()=>circle.classList.remove("flash"),200);

    if(navigator.vibrate)
      navigator.vibrate(200);
  }

  update();
};

function update(){
  document.getElementById("score").innerText=score;
  document.getElementById("combo").innerText=combo;
}

function start(){
  score=0;
  combo=0;
  time=30;
  running=true;

  bgm.currentTime=0;
  bgm.play();

  update();

  timer=setInterval(()=>{
    time--;
    document.getElementById("time").innerText=time;
    if(time<=0) end();
  },1000);

  changer=setInterval(randColor,700);
}

function retry(){
  clearInterval(timer);
  clearInterval(changer);
  start();
}

function end(){
  running=false;
  clearInterval(timer);
  clearInterval(changer);
  bgm.pause();
  msg.innerText="終了！";
}

randColor();

</script>

</body>
</html>
