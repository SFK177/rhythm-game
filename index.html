<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>館長の神ゲー「赤はおさないで」</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  text-align:center;
  background:linear-gradient(180deg,#0f2027,#203a43,#2c5364);
  color:white;
}

h1{
  margin-top:15px;
  text-shadow:0 0 10px cyan;
}

#game{
  margin-top:20px;
}

.circle{
  width:150px;
  height:150px;
  border-radius:50%;
  margin:30px auto;
  box-shadow:0 0 25px rgba(255,255,255,0.8);
}

button{
  font-size:18px;
  padding:10px 20px;
  margin:5px;
  border-radius:10px;
  border:none;
  background:#111;
  color:white;
  box-shadow:0 0 10px cyan;
}

#msg{
  font-size:26px;
  height:30px;
  margin-top:10px;
}

#score,#time,#rank{
  font-size:20px;
  margin:5px;
}
</style>
</head>

<body>

<h1>館長の神ゲー<br>「赤はおさないで」</h1>

<div id="score">Score: 0</div>
<div id="time">Time: 30</div>
<div id="rank"></div>

<button onclick="startGame()">スタート</button>
<button onclick="startGame()">再挑戦</button>

<div id="game">
  <div id="circle" class="circle"></div>
</div>

<div id="msg"></div>

<script>
let score=0;
let combo=0;
let time=30;
let playing=false;
let currentColor="";
let timer;
let colorTimer;

const circle=document.getElementById("circle");

function randomColor(){
  const r=Math.random();
  if(r<0.4) return "blue";
  if(r<0.8) return "green";
  return "red";
}

function showColor(){
  currentColor=randomColor();
  circle.style.background=currentColor;
}

circle.addEventListener("click",()=>{
  if(!playing) return;

  if(currentColor==="blue"){
    score+=1+combo;
    combo++;
    msg("いいよ");
  }
  else if(currentColor==="green"){
    score+=3+combo;
    combo++;
    msg("さいこー");
  }
  else if(currentColor==="red"){
    score=0;
    combo=0;
    flash();
    if(navigator.vibrate) navigator.vibrate(200);
    msg("いやーん");
  }

  updateScore();
});

function msg(t){
  document.getElementById("msg").innerText=t;
}

function flash(){
  document.body.style.background="white";
  setTimeout(()=>{
    document.body.style.background=
      "linear-gradient(180deg,#0f2027,#203a43,#2c5364)";
  },100);
}

function updateScore(){
  document.getElementById("score").innerText="Score: "+score;
}

function startGame(){
  score=0;
  combo=0;
  time=30;
  playing=true;
  document.getElementById("rank").innerText="";
  updateScore();
  document.getElementById("time").innerText="Time: "+time;

  clearInterval(timer);
  clearInterval(colorTimer);

  timer=setInterval(()=>{
    time--;
    document.getElementById("time").innerText="Time: "+time;
    if(time<=0){
      endGame();
    }
  },1000);

  colorTimer=setInterval(()=>{
    showColor();
  },700);
}

function endGame(){
  playing=false;
  clearInterval(timer);
  clearInterval(colorTimer);
  circle.style.background="gray";
  rank();
}

function rank(){
  let r="E";
  if(score>20) r="D";
  if(score>40) r="C";
  if(score>60) r="B";
  if(score>90) r="A";
  if(score>130) r="S";

  document.getElementById("rank").innerText="ランク: "+r;
}
</script>

</body>
</html>
