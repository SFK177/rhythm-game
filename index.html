<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Âà§Êñ≠Á™Å„Åç„ÉÅ„É£„É¨„É≥„Ç∏</title>

<style>
body{
 text-align:center;
 font-family:sans-serif;
 background:#f5f5f5;
}

#signal{
 width:180px;
 height:180px;
 margin:20px auto;
 border-radius:50%;
 background:gray;
}

button{
 padding:15px 30px;
 font-size:20px;
 margin:10px;
}

#tapBtn{
 background:black;
 color:white;
 border-radius:12px;
}

#score,#combo,#time{
 font-size:20px;
 margin:5px;
}
</style>
</head>

<body>

<h2>ü•ã Âà§Êñ≠Á™Å„Åç„ÉÅ„É£„É¨„É≥„Ç∏</h2>

<div id="signal"></div>

<button id="startBtn">„Çπ„Çø„Éº„Éà</button>
<button id="tapBtn">Á™Å„ÅçÔºÅ</button>

<p id="time">ÊÆã„ÇäÊôÇÈñì: 30</p>
<p id="score">„Çπ„Ç≥„Ç¢: 0</p>
<p id="combo">„Ç≥„É≥„Éú: 0</p>

<script>
const GAS_URL="https://script.google.com/macros/s/AKfycbw3iOC_7EBRqfXUZjnblOXdTI8gcLcpA8RqEf_lurK9YQhcO5AduBAMJBLo71qfbHET/exec";

let score=0;
let combo=0;
let current="";
let game=false;
let time=30;
let timer;
let loop;

const signal=document.getElementById("signal");

function beep(freq){
 const ctx=new (window.AudioContext||window.webkitAudioContext)();
 const osc=ctx.createOscillator();
 osc.type="sine";
 osc.frequency.value=freq;
 osc.connect(ctx.destination);
 osc.start();
 osc.stop(ctx.currentTime+0.08);
}

function update(){
 document.getElementById("score").textContent="„Çπ„Ç≥„Ç¢: "+score;
 document.getElementById("combo").textContent="„Ç≥„É≥„Éú: "+combo;
}

function nextSignal(){
 if(!game)return;

 if(Math.random()<0.7){
   current="hit";
   signal.style.background="blue";
 }else{
   current="trap";
   signal.style.background="red";
 }

 loop=setTimeout(nextSignal,600);
}

document.getElementById("tapBtn").onclick=()=>{
 if(!game)return;

 if(current==="hit"){
   combo++;
   score+=1+Math.floor(combo/5);
   beep(700);
 }else{
   // üî• Ëµ§„Éü„Çπ ‚Üí ÂÆåÂÖ®„É™„Çª„ÉÉ„Éà
   score=0;
   combo=0;
   beep(120);
 }

 update();
}

document.getElementById("startBtn").onclick=()=>{
 score=0;
 combo=0;
 time=30;
 game=true;
 update();

 document.getElementById("time").textContent="ÊÆã„ÇäÊôÇÈñì: "+time;

 nextSignal();

 timer=setInterval(()=>{
   time--;
   document.getElementById("time").textContent="ÊÆã„ÇäÊôÇÈñì: "+time;

   if(time<=0){
     endGame();
   }
 },1000);
}

function endGame(){
 game=false;
 clearInterval(timer);
 clearTimeout(loop);
 signal.style.background="gray";

 beep(80); //ÁµÇ‰∫ÜÈü≥

 const name=prompt("ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„É©„É≥„Ç≠„É≥„Ç∞ÈÄÅ‰ø°");
 if(name){
   fetch(GAS_URL,{
     method:"POST",
     body:JSON.stringify({name:name,score:score})
   });
 }

 alert("ÁµÇ‰∫ÜÔºÅ„Çπ„Ç≥„Ç¢Ôºö"+score);
}
</script>

</body>
</html>
