<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>æ­£æ‹³ä¸­æ®µçªããƒãƒ£ãƒ¬ãƒ³ã‚¸</title>

<style>
body{
  text-align:center;
  font-family:sans-serif;
  background:#f5f5f5;
}

h1{
  margin-top:30px;
}

#target{
  width:220px;
  height:220px;
  margin:40px auto;
  border-radius:50%;
}

button{
  font-size:20px;
  padding:10px 20px;
  margin:10px;
}

.flash{
  animation:flashRed 0.2s;
}

@keyframes flashRed{
  0%{background:#ff0000;}
  100%{background:#f5f5f5;}
}
</style>
</head>

<body>

<h1>æ­£æ‹³ä¸­æ®µçªã<br>åˆ¤æ–­ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>

<div id="target"></div>

<div>ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
<div>ã‚³ãƒ³ãƒœ: <span id="combo">0</span></div>
<div>æ®‹ã‚Š: <span id="time">30</span> ç§’</div>

<button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button onclick="location.reload()">å†æŒ‘æˆ¦</button>

<!-- éŸ³ -->
<audio id="bgm" loop>
<source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">
</audio>

<audio id="hit">
<source src="https://www.soundjay.com/mechanical/sounds/switch-3.mp3">
</audio>

<audio id="end">
<source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3">
</audio>

<!-- ãƒ©ãƒ³ã‚¯éŸ³ -->
<audio id="rankLow">
<source src="https://www.soundjay.com/button/sounds/button-10.mp3">
</audio>

<audio id="rankMid">
<source src="https://www.soundjay.com/button/sounds/button-4.mp3">
</audio>

<audio id="rankHigh">
<source src="https://www.soundjay.com/misc/sounds/fanfare-1.mp3">
</audio>

<script>
let score=0
let combo=0
let time=30
let playing=false
let type="blue"

// ãƒ©ãƒ³ã‚¯åˆ¤å®š
function getRank(s){

 if(s<50) return {name:"è¦‹ç¿’ã„", sound:"rankLow"}
 if(s<150) return {name:"åˆç´š", sound:"rankLow"}
 if(s<300) return {name:"ä¸­ç´š", sound:"rankMid"}
 if(s<500) return {name:"ä¸Šç´š", sound:"rankMid"}
 if(s<800) return {name:"é»’å¸¯å€™è£œ", sound:"rankHigh"}

 return {name:"å¸«ç¯„ç´š ğŸ”¥", sound:"rankHigh"}
}

// è‰²ç”Ÿæˆ
function nextTarget(){
 const r=Math.random()

 if(r<0.4){type="blue";target.style.background="blue"}
 else if(r<0.75){type="green";target.style.background="green"}
 else{type="red";target.style.background="red"}
}

// æŠ¼ã—ãŸæ™‚
target.onclick=()=>{
 if(!playing)return

 document.getElementById("hit").play()

 if(type==="blue"){
   score+=10
   combo++
 }

 else if(type==="green"){
   combo++
   score+=combo*2
 }

 else if(type==="red"){
   score=0
   combo=0

   if(navigator.vibrate) navigator.vibrate(200)

   document.body.classList.add("flash")
   setTimeout(()=>document.body.classList.remove("flash"),200)
 }

 update()
 nextTarget()
}

// æ›´æ–°è¡¨ç¤º
function update(){
 scoreEl.textContent=score
 comboEl.textContent=combo
}

// ã‚¹ã‚¿ãƒ¼ãƒˆ
startBtn.onclick=()=>{

 score=0
 combo=0
 time=30
 playing=true

 document.getElementById("bgm").volume=0.3
 document.getElementById("bgm").play()

 nextTarget()
 update()
 timeEl.textContent=time

 const timer=setInterval(()=>{

   time--
   timeEl.textContent=time

   if(time<=0){
     clearInterval(timer)
     playing=false

     document.getElementById("bgm").pause()
     document.getElementById("end").play()

     const result=getRank(score)

     document.getElementById(result.sound).play()

     setTimeout(()=>{
       alert("çµ‚äº†ï¼\nã‚¹ã‚³ã‚¢:"+score+"\nãƒ©ãƒ³ã‚¯ï¼š"+result.name)
     },300)
   }

 },1000)
}

const target=document.getElementById("target")
const scoreEl=document.getElementById("score")
const comboEl=document.getElementById("combo")
const timeEl=document.getElementById("time")
const startBtn=document.getElementById("startBtn")
</script>

</body>
</html>
