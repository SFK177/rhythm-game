<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{
margin:0;
font-family:sans-serif;
background:#0b1d26;
text-align:center;
overflow:hidden;
}

#circle{
width:180px;
height:180px;
border-radius:50%;
margin:50px auto;
}

#score{color:white;font-size:22px}
#combo{color:yellow}
#timer{color:white}

button{
padding:12px 24px;
font-size:18px;
}

.flash{
animation:flash 0.2s;
}
@keyframes flash{
0%{background:red}
100%{background:#0b1d26}
}
</style>
</head>

<body>

<h2 style="color:white">館長の神ゲー</h2>

<div id="score">Score:0</div>
<div id="combo">Combo:0</div>
<div id="timer">30</div>

<div id="circle"></div>

<button onclick="start()">スタート</button>

<script>

const URL="https://script.google.com/macros/s/AKfycbyxYEOHVtVb1axr6og0LcFPkINM2wC4t8d_aPpwnm0QQZ-Bt4UHxnIAyQMxarSdTqVM/exec"

let score=0
let combo=0
let time=30
let playing=false
let current=""

let bgm=new Audio("music.mp3")
bgm.loop=true

let miss=new AudioContext()

function beep(){
let o=miss.createOscillator()
let g=miss.createGain()
o.connect(g);g.connect(miss.destination)
o.frequency.value=100
o.start()
g.gain.exponentialRampToValueAtTime(0.0001,miss.currentTime+0.2)
}

function next(){

const r=Math.random()

if(r<0.33){current="blue";circle.style.background="blue"}
else if(r<0.66){current="green";circle.style.background="green"}
else{current="red";circle.style.background="red"}
}

circle.onclick=()=>{

if(!playing)return

if(current==="blue"){
score+=2
combo++
}
else if(current==="green"){
score+=1
combo++
}
else{
combo=0
navigator.vibrate(200)
beep()
document.body.classList.add("flash")
setTimeout(()=>document.body.classList.remove("flash"),200)
}

scoreTxt.innerText="Score:"+score
comboTxt.innerText="Combo:"+combo

next()
}

function start(){

score=0
combo=0
time=30
playing=true

bgm.play()

timer.innerText=time
scoreTxt.innerText="Score:0"
comboTxt.innerText="Combo:0"

next()

let t=setInterval(()=>{
time--
timer.innerText=time
if(time<=0){
clearInterval(t)
playing=false
bgm.pause()

let name=prompt("名前")
fetch(URL,{
method:"POST",
body:JSON.stringify({
Name:name,
Score:score,
Game:"判断",
Date:new Date().toLocaleString()
})
})

}
},1000)

}

</script>

</body>
</html>
