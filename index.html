<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  font-family:sans-serif;
  text-align:center;
  background:#111;
  color:white;
}

#target{
  width:200px;
  height:200px;
  margin:20px auto;
  border-radius:20px;
}

button{
  font-size:18px;
  padding:12px 20px;
  margin:5px;
}

#score{font-size:24px;}
#combo{font-size:20px;color:gold;}
#time{font-size:20px;}
</style>
</head>

<body>

<h2>ü•ã Âà§Êñ≠„Éà„É¨„Éº„Éã„É≥„Ç∞</h2>

<div id="time">30</div>
<div id="score">Score:0</div>
<div id="combo">Combo:0</div>

<div id="target"></div>

<button id="tapBtn">ÂèçÂøúÔºÅ</button>
<br>
<button id="startBtn">„Çπ„Çø„Éº„Éà</button>
<button id="retryBtn" style="display:none;">ÂÜçÊåëÊà¶</button>

<script>
const scriptURL="https://script.google.com/macros/s/AKfycbw3iOC_7EBRqfXUZjnblOXdTI8gcLcpA8RqEf_lurK9YQhcO5AduBAMJBLo71qfbHET/exec";

let score=0;
let combo=0;
let time=30;
let game=false;
let current="";

const target=document.getElementById("target");

const ctx=new(window.AudioContext||window.webkitAudioContext)();

function beep(freq){
 let o=ctx.createOscillator();
 let g=ctx.createGain();
 o.connect(g);
 g.connect(ctx.destination);
 o.frequency.value=freq;
 o.start();
 g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+0.2);
}

function randomTarget(){
 if(!game)return;

 let r=Math.random();

 if(r<0.33){
   target.style.background="blue";
   current="hit";
 }
 else if(r<0.66){
   target.style.background="green";
   current="hit";
 }
 else{
   target.style.background="red";
   current="no";
 }

 setTimeout(randomTarget,800);
}

document.getElementById("tapBtn").onclick=()=>{
 if(!game)return;

 if(current==="hit"){
   combo++;
   score+=1+Math.floor(combo/5);
   beep(700);
 }
 else{
   combo=0;
   score=Math.max(0,score-1);
   beep(200);
 }

 update();
}

function update(){
 document.getElementById("score").innerText="Score:"+score;
 document.getElementById("combo").innerText="Combo:"+combo;
}

document.getElementById("startBtn").onclick=()=>{
 ctx.resume();
 score=0;
 combo=0;
 time=30;
 game=true;
 update();

 document.getElementById("retryBtn").style.display="none";

 randomTarget();

 let timer=setInterval(()=>{
   time--;
   document.getElementById("time").innerText=time;

   if(time<=0){
     clearInterval(timer);
     game=false;
     target.style.background="black";
     beep(100);

     let name=prompt("ÂêçÂâçÂÖ•Âäõ");
     if(name){
       fetch(scriptURL,{
         method:"POST",
         body:JSON.stringify({name:name,score:score})
       });
     }

     document.getElementById("retryBtn").style.display="inline";
   }

 },1000);
}

document.getElementById("retryBtn").onclick=()=>{
 document.getElementById("startBtn").click();
}
</script>
</body>
</html>
